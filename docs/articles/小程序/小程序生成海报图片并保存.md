# 小程序生成图片并保存
自己做过几个小程序生成图片并保存的功能，觉得做这个功能用到的还挺多的，记录一下。

总体可以分为:
- 前端处理：后端返回数据，前端自己将图片、文字等画到 `canvas` 上，然后转图片。
- 后端处理：后端直接返回图片，前端只做保存功能。

## 前端处理
### canvas 画图片并保存


## 后端处理

> 整个图片都是后端返回的，前端只管保存就行了。

### 返回 base64 数据显示图片并保存
> 后端返回 base64 格式的情况

``` js
var imgSrc = this.data.imgSrc.slice(23); // 这里是把 data:image/png;base64,  这一段去除）
var save = wx.getFileSystemManager();
var number = Math.random() * 10;
save.writeFile({
    filePath: wx.env.USER_DATA_PATH + '/pic' + number + '.jpg',
    data: imgSrc,
    encoding: 'base64',
    success: res => {
    wx.saveImageToPhotosAlbum({ // 保存到相册
        filePath: wx.env.USER_DATA_PATH + '/pic' + number + '.jpg',
        success: function (res) {
        wx.showToast({
            title: '保存成功',
        })
        },
        fail: function (err) {
        console.log(err)
        }
    })
    console.log(res)
    },
    fail: err => {
    console.log(err)
    }
})
//   参考：https://www.cnblogs.com/china-fanny/p/11213746.html

```

### 保存网络图片到本地

> 返回网络图片并保存
 
``` js
  saveToPhone: function (e) {
    wx.downloadFile({
      url: '', // 网络图片地址
      success: res => {
        wx.saveImageToPhotosAlbum({
          filePath: res.tempFilePath,
          success: (data) => {
            console.log(data)
          },
          fail: (err) => {
            console.log(err);
          },
        })
      }
    })
  }
```